<?phpnamespace Home\Controller;use Think\Controller;define('API_TOKEN', 'kanubanji');class ApitesterController extends Controller {    public function index() {        header("Content-type:text/html;charset=utf-8");                $sign=I('sign',1,'intval');        if(IS_POST)        {            $link=I('link');            $param=I('param');            $key=I('key');            if(!isset($_POST['sign']))            {                $sign=0;            }            $this->assign('link',$link);            $this->assign('key',$key);            $this->assign('param',$param);            foreach ($key as $kk=>$k)            {                if(!empty($k))                {                    $data[$k]=$param[$kk];                }            }            $url=C('WEB_DOMAIN').'api.php?'.$link;            if($sign)            $data['sign']=  $this->getSign($data);            echo '请求数组:<br/>';            dump($data);            $return = $this->cpost($url, $data);                        echo '返回json:<br/>'.$return.'<br />解析后:<br />';            dump(json_decode($return,true));                    }                $this->assign('sign',$sign);        $this->display();    }    public function client()    {        echo         <<<EOF<script>    ws = new WebSocket("ws://banji.kanuvip.com:2346");    ws.onopen = function () {        var ss={a:'a',b:'b'};        ws.send(ss);    };    ws.onmessage = function (e) {        console.log(e.data);    };</script>EOF;    }    public function phpinfo(){        phpinfo();    }    private function cpost($url,$param,$post_file='')    {        $oCurl = curl_init();        if (stripos($url, "https://") !== FALSE) {            curl_setopt($oCurl, CURLOPT_SSL_VERIFYPEER, FALSE);            curl_setopt($oCurl, CURLOPT_SSL_VERIFYHOST, false);            curl_setopt($oCurl, CURLOPT_SSLVERSION, 1); //CURL_SSLVERSION_TLSv1        }        if (is_string($param) || $post_file) {            $strPOST = $param;        } else {            $aPOST = array();            foreach ($param as $key => $val) {                $aPOST[] = $key . "=" . urlencode($val);            }            $strPOST = join("&", $aPOST);        }        curl_setopt($oCurl, CURLOPT_URL, $url);        curl_setopt($oCurl, CURLOPT_RETURNTRANSFER, 1);        curl_setopt($oCurl, CURLOPT_POST, true);        curl_setopt($oCurl, CURLOPT_POSTFIELDS, $strPOST);        $sContent = curl_exec($oCurl);        $aStatus = curl_getinfo($oCurl);        curl_close($oCurl);        if (intval($aStatus["http_code"]) == 200) {            return $sContent;        } else {            return 'false';        }    }        private function getSign($data) {        ksort($data);        foreach ($data as $k => $v) {//            $v = urlencode($v);            $buff .= $k . "=" . $v . "&";        }        return md5($buff . API_TOKEN);    }        public function success($msg = '') {        if (is_array($msg)) {            foreach ($msg as &$m) {                if (empty($m)) {                    $m = '';                }            }        }        if (empty($msg))            $msg = '';        $data['msg'] = $msg;        $data['status'] = 1;        $this->ajaxReturn($data);        exit;    }    public function error($msg = '') {        $data['msg'] = $msg;        $data['status'] = 0;        $this->ajaxReturn($data);        exit;    }}