<?phpnamespace Common\Model;use Think\Model;class ClassMoneyLogModel extends Model {    protected $_validate = array(     array('class_id','require','请传入班级id！',self::MUST_VALIDATE),   );    protected $_auto = array (          array('addtime',NOW_TIME),     );    protected function _before_insert(&$data, $options) {        $class_id=$data['class_id'];        //计算当前余额        $yuearrs=$this->where(array('class_id'=>$class_id))->getField('sum(if(type=0,money,-money))');                $yuearr=array_keys($yuearrs);        $yue=$yuearr[0];        if(isset($data['type']) && $data['type']==1)        {            $data['now_money']=$yue-$data['money'];        }        else        {            $data['now_money']=$yue+$data['money'];        }             }}