<?phpnamespace Common\Model;use Think\Model;class StudentMoneyLogModel extends Model {    protected $_validate = array(     array('student_id','require','请传入学生id！',self::MUST_VALIDATE),   );    protected $_auto = array (          array('addtime',NOW_TIME),     );    protected function _before_insert(&$data, $options) {        $student_id=$data['student_id'];        //计算当前余额        $yuearrs=$this->where(array('student_id'=>$student_id))->getField('sum(if(type=0,money,-money))');                $yuearr=array_keys($yuearrs);        $yue=$yuearr[0];        if(isset($data['type']) && $data['type']==1)        {            $data['now_money']=$yue-$data['money'];        }        else        {            $data['now_money']=$yue+$data['money'];        }        $Student=M('Student');        $Student->where(array('id'=>$student_id))->setField('money',$data['now_money']);             }}