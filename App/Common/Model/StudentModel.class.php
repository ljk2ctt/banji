<?phpnamespace Common\Model;use Think\Model;class StudentModel extends Model {    protected $_auto=array(        array('birthday','strtotime',self::MODEL_BOTH,'function'),    );    protected function _after_select(&$resultSet, $options) {        foreach($resultSet as &$result)        {            if(false===$this->_after_find($result, $options))            {                return false;            }        }    }    protected function _after_find(&$result, $options) {        $result['cinfo']=D('Class')->find($result['class_id']);        $result['birthday_format']=  date('Y-m-d',$result['birthday']);        $result['tie_num']=  0;        if(!empty($result['phone']))        {            $result['tie_num']++;            //获取监护人头像            $result['pheaderurl']=M('Member')->getFieldByPhone($result['phone'],'headerurl');        }        else{            $result['pheaderurl']='';        }        if(!empty($result['phone2']))        {            $result['tie_num']++;            //获取监护人头像            $result['pheaderurl2']=M('Member')->getFieldByPhone($result['phone2'],'headerurl');        }        else        {            $result['pheaderurl2']='';        }    }    protected function _after_insert($data, $options) {        if(isset($data['money']) && $data['money']>0)        {            $StudentMoneyLog=D('StudentMoneyLog');            $sldata['student_id']=$data['id'];            $sldata['money']=$data['money'];            $sldata['note']='期初余额';            $StudentMoneyLog->add($sldata);        }    }}