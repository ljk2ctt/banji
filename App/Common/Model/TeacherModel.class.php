<?phpnamespace Common\Model;use Think\Model;class TeacherModel extends Model {    protected function _after_select(&$resultSet, $options) {        foreach($resultSet as &$result)        {            if(false===$this->_after_find($result, $options))            {                return false;            }        }    }    protected function _after_find(&$result, $options) {        $TeacherSubjectClassAccess  =   M('TeacherSubjectClassAccess');        $class_ids=$TeacherSubjectClassAccess->where(array('teacher_id'=>$result['id']))->getField('class_id',true);        if($class_ids)        {            $map['id']=array('in',$class_ids);            $cinfos=D('Class')->where($map)->select();            foreach($cinfos as &$cinfo)            {                $is_master=$result['master_class_id']==$cinfo['id']?'1':'0';                $subjectinfo=M()->table('__TEACHER_SUBJECT_CLASS_ACCESS__ tsca')->join('__SUBJECT__ s on s.id=tsca.subject_id','left')->where(array('tsca.teacher_id'=>$result['id'],'tsca.class_id'=>$cinfo['id']))->field('s.name')->find();                $role_code='1'===$is_master?1:3;                $cinfo['my_role']=array('role'=>'teacher','is_master'=>$is_master,'subject'=>$subjectinfo['name'],'role_code'=>$role_code);            }            $result['cinfos']=$cinfos;        }        else        {            $result['cinfos']=array();        }    }}