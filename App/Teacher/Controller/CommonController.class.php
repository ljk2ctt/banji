<?phpnamespace Teacher\Controller;use Think\Controller;class CommonController extends Controller {    public function _initialize() {        if ((!session('?token')) && CONTROLLER_NAME != 'Login') {            $this->redirect('Login/index');        }        $nav = array(            'Index' => array(0 => '数据维护', 'index' => '班级选择', 'student' => '学生管理', 'tongzhi' => '发布通知', 'zuoye' => '发布作业','history_tongzhi'=>'通知修改','history_zuoye'=>'作业修改','jiaweihui'=>'家委会管理'),        );        $this->assign('nav', $nav);        $left['数据维护'] = array('nav' => array(                '学生管理' => array('controller' => 'Index', 'action' => 'index'),                '发布通知' => array('controller' => 'Index', 'action' => 'tongzhi'),                '发布作业' => array('controller' => 'Index', 'action' => 'zuoye'),                '通知历史' => array('controller' => 'Message', 'action' => 'index'),                '作业历史' => array('controller' => 'Homework', 'action' => 'index'),                '家委会管理' => array('controller' => 'Index', 'action' => 'jiaweihui'),            )        );        $this->webtitle = '卡努科技班级管理系统';        $this->assign('left', $left);    }    protected function getSign($data) {        ksort($data);        foreach ($data as $k => $v) {//            $v = urlencode($v);            $buff .= $k . "=" . $v . "&";        }        return md5($buff . API_TOKEN);    }    protected function getdata($url, $param, $is_sign = true) {        if ($is_sign) {            unset($param['sign']);            $param['sign'] = $this->getSign($param);        }        $json = $this->cpost($url, $param);        $return = json_decode($json, true);        if (!$return) {            $this->error($json);        }        return $return;    }    protected function cpost($url, $param, $post_file = '') {        $url = C('WEB_DOMAIN') . 'api.php?' . $url;        $oCurl = curl_init();        if (stripos($url, "https://") !== FALSE) {            curl_setopt($oCurl, CURLOPT_SSL_VERIFYPEER, FALSE);            curl_setopt($oCurl, CURLOPT_SSL_VERIFYHOST, false);            curl_setopt($oCurl, CURLOPT_SSLVERSION, 1); //CURL_SSLVERSION_TLSv1        }        if (is_string($param) || $post_file) {            $strPOST = $param;        } else {            $aPOST = array();            foreach ($param as $key => $val) {                $aPOST[] = $key . "=" . urlencode($val);            }            $strPOST = join("&", $aPOST);        }        curl_setopt($oCurl, CURLOPT_URL, $url);        curl_setopt($oCurl, CURLOPT_RETURNTRANSFER, 1);        curl_setopt($oCurl, CURLOPT_POST, true);        curl_setopt($oCurl, CURLOPT_POSTFIELDS, $strPOST);        $sContent = curl_exec($oCurl);        $aStatus = curl_getinfo($oCurl);        curl_close($oCurl);        if (intval($aStatus["http_code"]) == 200) {            return $sContent;        } else {            die($aStatus["http_code"]);            return $sContent;        }    }}