<!--footer--></body><script src="/Public/Admin/js/myautocompleter.js"></script><script>    $(document).ready(function(){    var socket;    var initWebSocket = function() {        if (window.WebSocket) {            socket = new WebSocket("ws://120.76.193.149:{:C('WEB_SOCKET_PORT')}");            socket.onmessage = function(event) {                var json=JSON.parse(event.data);                WebSocketcallback(json);                if(json.msgtype==='change' && false!==json.interfaces.indexOf('mydMessageTap'))                {                    //:todo未读通知数                }                if(json.msgtype==='willoffline')                {                    online=false;                }            };            socket.onopen = function(event) {                online=true;                console.log('链接成功');                var data={};                data.bind={};                data.bind.token= "{:session('token')}" ;                data.bind.websocket_key= "{:session('websocket_key')}" ;                data.bind.connect_mode= "computer" ;                socket.send(JSON.stringify(data));            };            socket.onclose = function(event) {                if(online)                {                    initWebSocket();                }                else{                    window.location.href="{:U('Login/logout')}";                 }                console.log("Web Socket closed.");            };            socket.onerror = function(event) {                console.log("Web Socket error.");            };        } else {            console.log('websocket 不支持');        }    }    initWebSocket();    });</script></html>